<app-ui-modal
  [(isOpen)]="isEditProtocolModalOpen"
  width="1400"
>
  <div class="protocol-modal">
    <form class="form">
      <p class="form__subtitle">Додавання загальної інформації</p>
      <fieldset class="form__fieldset">
        <label class="form__label">Введіть назву Протоколу</label>
        <input #textInput class="form__text-input" type="text" placeholder="Назва Протоколу">
        <app-ui-button type="button" (btnClick)="addProtocolTitle($event)">Ввести</app-ui-button>
      </fieldset>
      <fieldset class="form__fieldset">
        <label class="form__label">Введіть вид ремонту</label>
        <input #textInput class="form__text-input" type="text" placeholder="Вид ремонту">
        <app-ui-button type="button" (btnClick)="addRepairType($event)">Ввести</app-ui-button>
      </fieldset>
      <p class="form__subtitle">Додавання інформації про обладнання</p>
      <fieldset class="form__fieldset">
        <label class="form__label">Інформація про обладнання</label>
        <input #textInput class="form__text-input" type="text" placeholder="Тип, зав. номер, місце встановлення тощо">
        <app-ui-button type="button" (btnClick)="addEquipmentInfo($event)">Додати</app-ui-button>
      </fieldset>
      <fieldset class="form__fieldset work">
        <label class="form__label">Введіть роботу</label>
        <input #textInput class="form__text-input" type="text" placeholder="Пункт ТІ">
        <textarea #textInput class="form__textarea" type="text" placeholder="Виконувана операція"></textarea>
        <app-ui-button type="button" (btnClick)="addJob($event)">Додати</app-ui-button>
      </fieldset>
      <p class="form__subtitle">Додавання додаткової інформації</p>
      <fieldset class="form__fieldset">
        <label class="form__label">Додаткова інформація</label>
        <input #textInput class="form__text-input" type="text" placeholder="Висновок, виконавець, дата ремонту тощо">
        <app-ui-button type="button" (btnClick)="addExtraInfo($event)">Додати</app-ui-button>
      </fieldset>
      <fieldset class="form__fieldset">
        <app-ui-button type="button" (btnClick)="addMeasurement()">Додати строку ЗВТ</app-ui-button>
      </fieldset>
      <div class="form__btns">
        <app-ui-button type="button" (btnClick)="editProtocol()">Редагувати Протокол</app-ui-button>
      </div>
    </form>
    <div class="protocol">
      <h3 class="protocol__name">{{ protocolName() }}</h3>
      <table class="protocol__table">
        <thead class="protocol__thead">
          @if (equipmentInfo().length === 0) {
            <tr class="protocol__tr">
              <th class="protocol__th"></th>
              <th class="protocol__th" colspan="2"></th>
            </tr>
          } @else {
            @if (equipmentInfo().length === 1) {
              <tr class="protocol__tr">
                <th class="protocol__th"></th>
                <th class="protocol__th longcell">{{ equipmentInfo()[0] }}</th>
                <th class="protocol__th longcell"></th>
                <th class="protocol__th longcell protocol__del-btn">
                  <app-ui-button (btnClick)="deleteEquipmentInfoRow(0)">Видалити</app-ui-button>
                </th>
              </tr>
            } @else {
              <tr class="protocol__tr">
                <th class="protocol__th" [attr.rowspan]="equipmentInfo().length"></th>
                <th class="protocol__th longcell">{{ equipmentInfo()[0] }}</th>
                <th class="protocol__th longcell"></th>
                <th class="protocol__th longcell protocol__del-btn">
                  <app-ui-button (btnClick)="deleteEquipmentInfoRow(0)">Видалити</app-ui-button>
                </th>
              </tr>
              @for (equipment of equipmentInfo(); let i = $index; track $index) {
                @if (i > 0) {
                  <tr class="protocol__tr">
                    <th class="protocol__th longcell">{{ equipment }}</th>
                    <th class="protocol__th longcell"></th>
                    <th class="protocol__th longcell protocol__del-btn">
                      <app-ui-button (btnClick)="deleteEquipmentInfoRow(i)">Видалити</app-ui-button>
                    </th>
                  </tr>
                }
              }
            }
          }
        </thead>
        <tbody class="protocol__tbody">
        <tr class="protocol__tr">
          <td class="protocol__td">{{ repairType() }}</td>
          <td class="protocol__td">Роботи, що виконуються</td>
          <td class="protocol__td">Результат</td>
        </tr>
          @for (job of jobs(); track $index) {
            @if (job.jobsDesc.length === 1) {
              <tr class="protocol__tr">
                <td class="protocol__td">{{ job.number }}</td>
                <td class="protocol__td">{{ job.jobsDesc[0] }}</td>
                <td class="protocol__td"></td>
                <td class="protocol__td protocol__del-btn">
                  <app-ui-button (btnClick)="deleteJob(job.number, 0)">Видалити</app-ui-button>
                </td>
              </tr>
            } @else {
              <tr class="protocol__tr">
                <td class="protocol__td" [attr.rowspan]="job.jobsDesc.length">{{ job.number }}</td>
                <td class="protocol__td">{{ job.jobsDesc[0] }}</td>
                <td class="protocol__td"></td>
                <td class="protocol__td protocol__del-btn">
                  <app-ui-button (btnClick)="deleteJob(job.number, 0)">Видалити</app-ui-button>
                </td>
              </tr>
              @for (jobDesc of job.jobsDesc; let i = $index; track $index) {
                @if (i > 0) {
                  <tr class="protocol__tr">
                    <td class="protocol__td longcell">{{ jobDesc }}</td>
                    <td class="protocol__td longcell"></td>
                    <td class="protocol__td longcell protocol__del-btn">
                      <app-ui-button (btnClick)="deleteJob(job.number, i)">Видалити</app-ui-button>
                    </td>
                  </tr>
                }
              }
            }
          }
        </tbody>
        <tfoot class="protocol__tfoot">
          @if (extraInfo().length === 1) {
            <tr class="protocol__tr">
              <td class="protocol__td"></td>
              <td class="protocol__td">{{ extraInfo()[0] }}</td>
              <td class="protocol__td"></td>
              <td class="protocol__td protocol__del-btn">
                <app-ui-button (btnClick)="deleteExtraInfoRow(0)">Видалити</app-ui-button>
              </td>
            </tr>
          } @else {
            @if (extraInfo().length > 1) {
              <tr class="protocol__tr">
                <td class="protocol__td" [attr.rowspan]="extraInfo().length"></td>
                <td class="protocol__td">{{ extraInfo()[0] }}</td>
                <td class="protocol__td"></td>
                <td class="protocol__td protocol__del-btn">
                  <app-ui-button (btnClick)="deleteExtraInfoRow(0)">Видалити</app-ui-button>
                </td>
              </tr>
              @for (info of extraInfo(); let i = $index; track $index) {
                @if (i > 0) {
                  <tr class="protocol__tr">
                    <td class="protocol__td longcell">{{ info }}</td>
                    <td class="protocol__td longcell"></td>
                    <td class="protocol__td longcell protocol__del-btn">
                      <app-ui-button (btnClick)="deleteExtraInfoRow(i)">Видалити</app-ui-button>
                    </td>
                  </tr>
                }
              }
            }

          }
        </tfoot>
      </table>
      @if (measurements()) {
        <h3 class="protocol__zvt-text">При роботі використовувались ЗВТ:</h3>
        <table class="protocol__zvt-table">
          <thead class="protocol__zvt-thead">
          <th class="protocol__zvt-th">Найменування</th>
          <th class="protocol__zvt-th">Тип</th>
          <th class="protocol__zvt-th">Заводський номер</th>
          <th class="protocol__zvt-th">Дата наступної перевірки</th>

          <tbody class="protocol__zvt-tbody">
            @for (_ of measurementsArray(); track $index) {
              <tr class="protocol__zvt-tr">
                <th class="protocol__zvt-td"></th>
                <th class="protocol__zvt-td"></th>
                <th class="protocol__zvt-td"></th>
                <th class="protocol__zvt-td"></th>
                <th class="protocol__zvt-td protocol__zvt-del-btn">
                  <app-ui-button (btnClick)="deleteMeasurement()">Видалити</app-ui-button>
                </th>
              </tr>
            }

          </tbody>
        </table>
      }

    </div>
  </div>
</app-ui-modal>

